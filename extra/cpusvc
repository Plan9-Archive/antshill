#!/bin/rc

echo 20000 >/tmp/nextport

rfork
while(usercmd=`{read}){
	switch($usercmd){
	case spawn*
		echo spawn not supported on cpu node
	case fetch*
		cpuport=`{cat /tmp/nextport}
		fetchroot -d $usercmd(2) -p $cpuport &
		echo rcpu -h tcp!^$sysname^!^$cpuport
		cpuport=`{echo $cpuport '+ 1' |hoc}
		echo $cpuport >/tmp/nextport
	case save*
		echo save
	case clean*
		echo clean
	case exit
		exit
	case *
		echo unknown
	}
}

